db.turnup.rds.create_db_parameter_group:
  DBParameterGroupName: ${DB_PARAMETER_GROUP_NAME}
  DBParameterGroupFamily: ${DB_PARAMETER_GROUP_FAMILY}
  Description: Sage parameter group
db.turnup.rds.modify_db_parameter_group:
  DBParameterGroupName: ${DB_PARAMETER_GROUP_NAME}
  Parameters:
    - ParameterName: rds.force_ssl
      ParameterValue: "0"
      ApplyMethod: immediate
db.turnup.rds.describe_db_parameter_groups:
  DBParameterGroupName: ${DB_PARAMETER_GROUP_NAME}
db.turnup.rds.create_db_instance:
  AllocatedStorage: ${DB_ALLOCATED_STORAGE}
  DBInstanceClass: ${DB_INSTANCE_CLASS}
  DBName: ${DB_NAME}
  DBInstanceIdentifier: ${DB_INSTANCE_IDENTIFIER}
  DBParameterGroupName: ${DB_PARAMETER_GROUP_NAME}
  VpcSecurityGroupIds:
    - $(db.turnup.ec2.describe_security_groups.SecurityGroups.0.GroupId)
  Engine: ${DB_ENGINE}
  MasterUsername: ${DB_USERNAME}
  MasterUserPassword: ${DB_PASSWORD}
db.turnup.rds_instance_availiable.wait:
  DBInstanceIdentifier: ${DB_INSTANCE_IDENTIFIER}
db.turnup.rds.describe_db_instances:
  DBInstanceIdentifier: ${DB_INSTANCE_IDENTIFIER}
db.turnup.route53.change_resource_record_sets:
  HostedZoneId: $(sage.route53.list_hosted_zones_by_name.HostedZones.0.Id)
  ChangeBatch:
    Changes:
      - Action: UPSERT
        ResourceRecordSet:
          Name: ${DB_DOMAIN}
          Type: CNAME
          TTL: 300
          ResourceRecords:
            - Value: $(db.rds.describe_db_instances.DBInstances.0.Endpoint.Address)
