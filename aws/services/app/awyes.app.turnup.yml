

app.turnup.ecs.create_service:
  serviceName: ${APP_NAME}
  cluster: $(cluster.ecs.create_cluster.cluster.clusterArn)
  taskDefinition: $(app.turnup.ecs.register_task_definition.taskDefinition.taskDefinitionArn)
  desiredCount: ${APP_CONTAINER_TASK_COUNT}
  loadBalancers:
    - targetGroupArn: $(app.turnup.elb.create_target_group.TargetGroups.0.TargetGroupArn)
      containerName: ${APP_NAME}
      containerPort: ${APP_CONTAINER_PORT}
  launchType: FARGATE
  networkConfiguration:
    awsvpcConfiguration:
      subnets: $(infra.get_subnet_ids)
      securityGroups:
        - $(app.ec2.describe_security_groups.SecurityGroups.0.GroupId)
      assignPublicIp: ENABLED
app.turnup.ecs.update_service:
  service: ${APP_NAME}
  cluster: $(cluster.ecs.create_cluster.cluster.clusterArn)
  taskDefinition: $(app.turnup.ecs.register_task_definition.taskDefinition.taskDefinitionArn)
  forceNewDeployment: true
